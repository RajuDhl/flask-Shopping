{% extends "base.html" %}
{% block content %}
{% include 'nav.html' %}

<div class="container-fluid min-vh-100">
        <div class="row align-items-center" style="margin-top:7%;" id="user_management">
            <div class="col-md col-lg"></div>
            <div class="col-xs col-sm">

                {% if message %}
                    <div class="alert alert-warning">{{message}}</div>
                {% else %}
                    <div style="padding:.75rem 1.25rem; margin-bottom:1rem;">&nbsp;</div>
                {% endif %}
                <h3>User Management</h3>
            <table class="table table-striped table-responsive-sm" id="user_management">
            <thead class="thead-dark">
            <tr><th>Email</th>
                <th>Last Activity</th>
                <th style="text-align:center;">Admin</th>
               <th style="text-align:center;">Permission</th>
                <th style="text-align:center;">Assign Permission</th>
                <th style="text-align:center;">Remove Access</th>
            </tr>
            </thead>
            <tbody>
                {% for record in users if record['verified']%}
                    <tr><td >{{ record['email'] }}</td>
                        <td>{{ record['activity'] }}</td>
                        {% if record.has_roles('Admin') %}
                        <td style="text-align:center;">
                            <button onclick= "changeUser('{{ record["uuid"] }}', '/remove-admin/')">
                                <i class="fa fa-check-square-o" aria-hidden="true" title="Remove admin access"></i>
                            </button></td>
                        {% else %}
                        <td style="text-align:center;">
                            <button onclick="changeUser('{{ record["uuid"] }}', '/give-admin/')" title="Give admin access">
                                <i class="fa fa-square-o" aria-hidden="true"></i>
                            </button></td>
                        {% endif %}
                        <td >
                            {% for x in record.roles%}
                                {{x}}
                            {% endfor %}
                        </td>
                        {% if record.has_roles('Admin') %}
                        <td>
                            
                        </td>
                        {% else %}
                            <td style="text-align:center";> <button onclick="set_permission('{{record['email'] }}')" title="assign permission"><i class="fa fa-lock" aria-hidden="true"></i></button></td>
                            <input type="hidden" name="username" value="{{record['email']}}" id="username">
                        {%endif%}
                        <td style="text-align:center;">
                            <button
                                    onclick="changeUser('{{ record["uuid"] }}', '/remove-user/')"
                                    title="Delete user"
                                    {% if record.has_roles('Admin') %} disabled {% endif %}
                            >
                                <i class="fa fa-remove" aria-hidden="true"></i>
                            </button></td>
                    </tr>
                {% endfor %}
            </tbody>
            </table>
            </div>
            <div class="col-md col-lg"></div>
        </div>
        <div class="row align-items-center " style="margin-top:7%;display: none;margin-left: 450px;" id="permission_management">
            <div class="col-md col-lg"></div>
            <div class="col-xs col-sm">
                {% if message %}
                    <div class="alert alert-warning">{{message}}</div>
                {% else %}
                    <div style="padding:.75rem 1.25rem; margin-bottom:1rem;">&nbsp;</div>
                {% endif %}
                <h3>Permission Management</h3><br>
            <div class="form-group m-3">
                <label for="cus_num">Username
                    <input type="text" name="email" value="" readonly="" class="form-control" id="user_email">
                </label>

            </div>
            <div class="form-group m-3">
                <label for="permission">Assign Permission
                    <div id="permission"/>
                    {#<select class="form-control" name="permission" id="permission" tabindex="2" multiple="multiple">
                        <option value="Repo"> Repo Log</option>
                        <option value="Extension"> Extension Log</option>
                        <option value="Title">Title Follow-Up</option>
                        <option value="PIF">PIF Log</option>
                    </select>#}
                </label>
            </div>
                <!---<div class="form-check m-2">
                    <label class="form-check-label m-2" for="exampleCheck1">Title FollowUp</label>
                    <input type="checkbox" class="form-check-input m-3" id="exampleCheck1"  name="allow_title_followup">
                </div>------>
                <button class="btn btn-dark btn-lg mr-5"
                        id="submit_button" onclick="changeUserPermission('/assign-permission')" 
                        >Set</button>
            </div>
            <div class="col-md col-lg"></div>
        </div>
</div>
<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-firestore.js"></script>
<script src="/static/dist/js/sortable.min.js"></script>
<script type="text/javascript" src="/static/dist/js/BsMultiSelect.js"></script>
<script src="/static/js/users.js"></script>
{% endblock %}